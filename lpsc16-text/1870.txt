 FITS  FORMAT  FOR  PLANETARY  SURFACES:  BRIDGING  THE  GAP  BETWEEN  FITS  WORLD COORDINATE SYSTEMS AND GEOGRAPHICAL INFORMATION SYSTEMS.  C. Marmo1, T.M. Hare2, S. Erard3, B. Cecconi3, F. Costard1, F. Schmidt1 and A. P. Rossi4, 1GEOPS, Univ. Paris-Sud, CNRS, Univ. Paris-Saclay, Rue  du  Belvédère,  Bât.  509,  91405  Orsay,  France,  chiara.marmo@u-psud.fr,  2U.  S.  Geological  Survey, Astrogeology Science  Center,  Flagstaff,  AZ,  3LESIA,  Observatoire  de  Paris,  PSL Research  University,  CNRS, Sorbonne Universités, UPMC Univ. Paris 06, Univ. Paris Diderot, Sorbonne Paris Cité , Meudon, France,  4Jacobs University, Bremen, Germany. Introduction:  The  amount  of  available  data  is rapidly  increasing  for  planetary  investigations  and planetary  surface  research  continues  to  evolve  from mostly  visual  assessment  to  more  automated quantitative analysis. Both  geologists  and  now  more  astronomers  are involved in mapping planetary surfaces. Geologists, for their  mapping  and  analysis  needs,  commonly  use Geographical  Information Systems (GIS).  In  general, GIS  applications  excel  in  data  interoperability  even though some have historically been anchored to Earth's spatial description. Astronomers, in contrast, are well known for their open and flexible formats and software for  quantitative  analysis  of  huge  data  sets. Unfortunately,  the  astronomy  domain  is  not accustomed  to  supporting  data  for  three-dimensional planetary surfaces. This  abstract  will  describe  how  Flexible  Image Transport  System  (FITS) World  Coordinate  System (WCS) [1] metadata can be translated for the planetary domain to  allow FITS data to  interoperate  with GIS applications. In  particular,  we  will  discuss  the  translation between WCS and Planetary Data System (PDS) and Integrated  Software  for  Imagers  and  Spectrometers (ISIS) format terminology and an alternative approach to  convert  FITS  into  a  Geospatial  Data  Abstraction Library (GDAL) Virtual Header Format (VRT) [2] as a first step for FITS visualization within GIS software. Why  FITS: FITS  has  been  defined  for  data acquisition and archiving in astronomical observatories and is used for spatial telescope data. FITS is one of the standard formats in the Virtual Observatory (VO), it is compatible with PDS archiving specifications and supported  by  a  large  number  of  open  libraries  and software  tools.  The  option  to  use  FITS  within  the planetary  domain  could  be  an  opportunity  to  allow more  seamless  sharing of  data  across  these different domains  and  potentially  homogenize  methods  from acquisition, to visualization, while giving more chances to optimize data processing. FITS WCS: FITS WCS representation simplifies the  spatial  coordinate  description  with  respect  to historical  terrestrial  references.  There  is  no  need  for oblique  projection  definitions  [3,4]  as  projection parameters  (projection  center  or  reference  point) describe  the  difference  between  the  Mercator  and Transverse  Mercator  or  Simple  Cylindrical  and Equirectangular map projections. There is no need for East or West positive longitude definitions as the pixel conversion in world coordinates is set  by a common oriented matrix. However,  if  still  needed,  FITS  does  offer  the possibility  to  fully  describe  those  same  parameters using  alternative  WCS  definitions  (meters,  degrees, East and West longitude, etc.) [5]. Nevertheless, WCS does not record information about the body shape and orientation, and reference surface. This limitation must be addressed to support surface studies. PDS/ISIS dictionaries as Mapped to FITS: Table 1 contains the translation between FITS and PDS/ISIS nomenclature  for  the  most  popular  projections.  The conversion between projection parameters depends on projection  type,  thus  as  an  example,  Table  2  gives conversion for cylindrical projections in degrees. Table 1. Projections FITS FITS projection name PDS/ISIS projection name SFL Sanson-Flamsteed Sinusoidal ZEA Zenithal Equal-Area Lambertazimuthalequalarea COO Conic orthomorphic Lambertconformal CAR plate carre Equirectangular MER Mercator Mercator SIN Orthographic Orthographic AZP Zenithal perspective Pointperspective STG Stereographic Polarstereographic Table  2.  Parameters  for  cylindrical  projections (coordinates in degrees) FITS parameter ISIS conversion PDS conversion CRPIX1 Samples / 2 + 0.5 LINE_SAMPLES / 2 + 0.5 CRPIX2 Lines / 2 + 0.5 LINES / 2 + 0.5 CRVAL1 CenterLongitude CENTER_LONGITUDE CRVAL2 CenterLatitude CENTER_LATITUDE CD1_1, CD2_2  1 / Scale 1 /  MAP_RESOLUTION FITS  and  GDAL:  The  Geospatial  Data Abstraction  Library,  released  by  the  Open  Source  Geospatial  Foundation,  offers  powerful  data conversion  and  processing  capabilities.  GDAL  is essentially a format translation library written in C++ for geospatial raster and vector data [6]. In 2007, the ISIS2  and  PDS  readers  were  updated  and  ISIS3 support was added. Any application which supports the GDAL library can now easily recognize these planetary data formats, including the planet definition, projection parameters,  and  label  information  like  pixel  value offset and multiplier. Fortunately,  GDAL also has support  for FITS via the popular CFITSIO library [7]. Next we discuss some of the known issues that should be addressed in GDAL, besides  our  needed  FITS  keywords  to  support geospatial  applications.  We  will  also  discuss  an alternative method to more quickly add GIS support for FITS  images  using  a  GDAL-supported  detached header. Known Issues: Similar to PDS, FITS often stores pixels as a result of a quantization  (i.e.  conversion  from  real  numbers  to integers  while  maintaining  an  offset  and  multiplier value to allow the original range to be recovered). To facilitate  analysis,  without  user  intervention,  GDAL should apply the defined offset and multiplier values before  returning  data  to  the  user.  FITS  images  are always  stored  as  signed  integers  and  the  supported BZERO  and  BSCALE  keywords  (corresponding  to offset and multiplier in ISIS) also allow FITS to better support  unsigned  data  range.  The  CFITSIO  library automatically  manages  conversion  between  different data  types in FITS,  but  currently CFITSIO rescaling causes overflows with GDAL and has been disabled. During the conversion from PDS and ISIS, or even TIFF, the GDAL readers do not automatically scale the pixel  values  and  depend  on  the application to  apply these  adjustments  for  the  user.  By  updating  this BZERO and BSCALE behavior in GDAL within the FITS format, it would be a good opportunity to address this  limitation  in  the  ISIS  and  PDS  readers  and possibly  offer  this  dynamic  adjustment  within  all supported GDAL formats. GDAL Virtual Header: The  VRT  format  is  a  verbose  XML-based  detached header  created  by  the  GDAL  team.  It  is  a  very powerful  mechanism to  describe  diverse  images  (or groups of images - for example a virtual mosaic). VRT files  can  simply describe  the  internal  structure  of  a FITS image but it can also describe the map projection and  body  size  in  a  standardized  "well  known  text" (WKT)  projection  string.  Unfortunately,  the  current FITS implementation in GDAL does not propagate all the original metadata into the output VRT file but this will  be  updated.  For  FITS  VRT  examples  and conversion  tools  please  see:  https://github.com/epnvespa/fits2vrt. Shape  and  orientation  keywords:  Generally, planetary body shapes and orientations are well defined and  standardized  by  the  International  Astronomical Union  (IAU)  Working  Group  on  Cartographic Coordinates  and  Rotational  Elements  (WGCCRE). This group reports triennially on the preferred rotation rate,  spin axis, prime meridian, and reference surface for  planets  and  satellites  which  helps  ensure  that cartographic endeavors are effectively comparable [8]. In  the  framework  of  the  European  Virtual Observatory project  (VESPA) [9]  a FITS convention for planetary data will be proposed [10] following the WGCCRE schema. Future  work:  In  the  coming  months  the  new keywords  to  allow FITS  to  support  planetary bodies will  be  defined  and  tested.  Once  the  proposed geospatial extensions are fully agreed upon and added into  FITS,  the  GDAL  library  will  be  updated  to properly map these new keywords. To help contribute or  follow updates  to  the  GDAL FITS  driver,  please see:  https://github.com/epn-vespa/gdal. References: [1]  http://fits.gsfc.nasa.gov/fits_wcs.html.  [2] http://www.gdal.org/gdal_vrttut.html.  [3] Snyder,  J.  P. (1987)  Professional  paper:  USGS,  U.S.  Government Printing Office. [4] Calabretta, M. R.  and Greisen, E. W. (2002) A&A, 395:1077-1122. [5] Greisen, E. W. and Calabretta,  M. R. (2002)  A&A, 395:1061-1075. [6] Hare, T.M., et al. (2007), LPSC 39, abs #2536, [7] http://heasarc.gsfc.nasa.gov/fitsio/fitsio.html.  [8] Archinal, B.A., et al. (2011), Celestial Mechanics and Dynamical  Astronomy,  109,  no.  2,  Feb.,  101-135, doi:10.1007/s10569-010-9320-4. [9]  http://europlanetvespa.eu/ [10] https://epn-vespa.github.io/geofits/. Acknowledgments:   This  work  benefits  from support  of  VESPA/Europlanet.  The Europlanet  2020 Research  Infrastructure  is  funded  by  the  European Union under the Horizon 2020 research and innovation programme, grant agreement N° 654208.  https://epn-vespa.github.io/geofits/ http://europlanet-vespa.eu/ http://europlanet-vespa.eu/ http://heasarc.gsfc.nasa.gov/fitsio/fitsio.html http://www.gdal.org/gdal_vrttut.html http://fits.gsfc.nasa.gov/fits_wcs.html https://github.com/epn-vespa/gdal https://github.com/epn-vespa/fits2vrt https://github.com/epn-vespa/fits2vrt