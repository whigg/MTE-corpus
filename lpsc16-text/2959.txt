 FIRST GLOBAL DIGITAL ELEVATION MODEL OF MERCURY. Kris. J. Becker1, Mark. S. Robinson2, Tammy. L. Becker1, Lynn. A. Weller1, Kenneth. L. Edmundson1, Gregory. A. Neumann3, Mark. E. Perry4, Sean. C. Solomon5,6. 1Astrogeology Science Center, United States Geological Survey, Flagstaff, AZ 86001; 2School of Earth and Space Exploration, Arizona State University Tempe, AZ, 85287; 3NASA Goddard Space Flight Center, Greenbelt, MD 20771; 4Johns Hopkins University Applied Physics Laboratory, Laurel, MD 20723; 5Lamont-Doherty Earth Observatory, Columbia University, Palisades, NY 10964; 6Department of Terrestrial Magnetism, Carnegie Institution of Washington, Washington, DC 20015. (kbecker@usgs.gov)  Introduction: The MErcury Surface, Space ENvironment, GEochemistry, and Ranging (MESSENGER) spacecraft [1] completed its mission to acquire a rich variety of orbital data from the planet Mercury. Using the Integrated Software for Imagers and Spectrometers (ISIS3) [2] and observations from Mercury Dual Imaging System (MDIS) narrow-angle camera (NAC) and multispectral wide-angle camera (WAC) [3], we derived a global digital elevation model (DEM) of Mercury. Methodology: We created the global DEM of Mercury from a least-squares bundle adjustment (jigsaw in ISIS3 [4]) of common features, measured as tie point coordinates in overlapping NAC and WAC-G filter images. The MDIS image inventory contains over 176,000 NAC and WAC-G observations with a very large variety of disparate geometric and illumination characteristics, and we encountered limitations to existing conventional control techniques in ISIS3 that required development of new software and techniques.  Background: A previous version of a control network solution and derived global DEM [5] used the conventional ISIS3 control techniques. The control point network created for this DEM was very sparse because of the limitations within ISIS3 applications.  The initial step in creation of a control network is the identification of overlapping areas between images from ephemeris data (e.g., spacecraft position and pointing attitude from mission Navigation and Ancillary Information Facility SPICE data [6]). SPICE data can contain uncertainties that limit accurate identification of overlap between images and precise measurement of image tie points. Control point networks contain tie points that are sample/line coordinates with geometric locations (derived from SPICE) that are automatically measured across the overlapping image areas. Tie point locations are typically randomly placed on images, often in areas of low contrast and shadows. Although generally successful, the area-based pattern matching method for sub-pixel registration of these tie point locations can produce mismatches which become outliers in the bundle adjustment and are difficult to identify and correct with existing ISIS3 tools.  As the control network grows in tie point density and because the current network applications are single threaded, processing becomes inefficient within ISIS3. The time and resources previously required to control the MDIS images and create a DEM of sufficient resolution, coverage and quality was unacceptable. This inefficiency became more evident when adding a large number of newly acquired images to the control network, forcing the consideration of a new approach. A New Approach: Our main objectives were to 1) significantly improve image tie point matching accuracy while increasing control point density, and 2) greatly reduce the resources, both human and computer, required to control large image datasets. The new approach utilizes unsupervised image-to-image featurebased matching and control techniques that are well suited for scaling and distribution across compute cluster environments. Image Matching: We used the OpenCV [7] application program interface to develop a new ISIS3 application called findfeatures that combines feature-based matching of tie point measurements in overlapping image pairs with robust outlier detection. The application accepts a list of all images that overlap the reference image, which are then matched simultaneously by taking advantage of OpenCV multi-threaded processing. The output is an image-based control network of all common tie points in the overlapping regions. Feature Detection: Fundamentally, most feature detection algorithms are implemented under the assumption of either spatial consistency or scale, rotation and translation invariance. Because orbital data are commonly acquired under different geometric orientations, a fast geometric transform was implemented that applies geometric relationships of image pairs computed from SPICE data. Although at times inaccurate, SPICE data are typically sufficient to orient the images to acceptable spatial consistency allowing utilization of all OpenCV feature matching algorithms to create unique solutions that address geometric and illumination differences in remotely sensed data. Since feature-based matching concentrates on high-contrast boundaries (e.g., topography, reflectance) resolution of landforms is significantly improved. Outlier Detection: As with area-based matching, feature-based matching can also produce mismatches. We implemented a robust outlier detection scheme that consists of four main steps: 1) bi-directional ratio test of two closest matches of each tie point, 2) symmetry test of bi-directional matches, 3) epipolar (stereo) constraints from a fundamental matrix using random sampling consensus (RANSAC), and 4) projective relationship using a homography (rotation) matrix. This approach proved effective in identifying and removing mismatches. This is a significant improvement in that outlier detection is performed both in the matching phase and in the bundle adjustment. Density: We found that some of the feature detection algorithms in OpenCV can identify a very large number of candidate features. FASTX [8] was one such algorithm that could detect up to 20,000 features in the majority of MDIS images. Large numbers of features can substantially impede the efficiency of outlier detection. Full parameterization of OpenCV algorithms allowed us to restrict points to a manageable number (400) of the best-matched features in overlapping regions. Efficiency: The global equirectangular map was partitioned into 720 10°×10° tiles. Images were placed in tiles by their center image latitude/longitude coordi nates. Processing scripts were developed and dispatched to our compute cluster that ran the multi-threaded feature matcher on all images in each tile to produce local control networks. These networks were combined into larger control networks partitioned into 14 tiles for global coverage, each individually bundle-adjusted to identify problems. Northern and southern hemisphere control networks were also created and bundle adjusted again to confirm consistency. The north and south networks were combined and a final bundle adjustment was performed. Results: From 176,352 images, we selected a subset limited by pixel scale (75 to 800 m/pixel; NAC (64,086) and WAC-G (37,091) images), and successfully controlled 100,432 images (63,536 NAC, 36,896 WAC-G) to sub-pixel accuracy (0.86 average pixel residual from the bundle adjustment). We used the efficient FASTX feature detector that is well suited for identification of landforms. A SIFT [9] descriptor extractor and BruteForce [7] matcher was used to create the control measures from overlapping image pairs. The final global control network contained 12,596,336 control points and 94,745,475 tie point measurements. This is the largest control network ever processed in ISIS3. A preliminary comparison of the global control point cloud with the Mercury Laser Altimeter/Radio Science DEM appears elsewhere [10]. We interpolated a global DEM at 64 pixels/degree (665 m/pixel) directly from the control network point cloud (an irregularly spaced dataset) stored in a kd-tree structure by selecting the nearest 11 points closest to the center output DEM pixel geometric coordinate. From those 11 points, a 1.0-standard-deviation filter centered about the median radius was applied to eliminate outliers. The median radius from the remaining points was selected as the output DEM radius value. A series of averaging filters smoothed the final DEM (Fig. 1, Table 1), given relative to a datum radius of 2439.4 km. Highlights: We resampled the DEM to 2 km pixel scale (to increase signal-to-noise ratio) and computed key summary parameters (slopes calculated over a 3×3 pixel box or 6-km baseline). The north and south polar regions (65°N to 90°N and 65°S to 88°S) are on average lower in elevation than the equatorial region (-1078 m, 909 m, 183 m, respectively), and the south polar area is rougher than the north polar and equatorial regions (average slopes 2.0°, 1.3°, 1.8°).  On a local level the DEM reveals many landforms of volcanic and tectonic origin. These include low-relief and broad positive-relief features (potential shield volcanoes?), linear negative relief features (extensional tectonism?), and isolated massifs (remnants of now buried basins?). Future Work: OpenCV provides a diverse set of feature matching capabilities that should be tested with the MDIS image dataset for better accuracy. Adding more images, eventually controlling all MDIS images, could increase the density of the MDIS network. Comparing a WAC-only DEM with the WAC-NAC DEM may reveal uncertainties in camera models.  References: [1] Solomon, S.C. et al. (2001) Planet. Space Sci., 49, 1445-1465. [2] Kestay, L. et al. (2014) LPS, 45, Abstract 1686. [3] Hawkins, S.E. III et al. (2007) Space Sci. Rev., 131, 247-338. [4] Edmundson, K.L. et al. (2012) ISPRS Annals, I-4, 203-208.  [5] Becker, K.J. et al. (2013) LPS, 44, Abstract 2829. [6] Acton, C.H. (1996) Planet. Space Sci. 44, 65-70. [7] Bradski, G. (2000) Dr. Dobb's Journal of Software Tools, drdobbs.com. [8] Rosten, E. et al. (2006) Comp. Vision-ECCV, 430-443. [9] Lowe, D.G. (2004) Inter. J. Comp. Vision, 60, 2, 91-110. [10] Neumann, G.A. et al. (2016), LPS, 47, this meeting.   Fig. 1. Color-coded shaded relief computed from global DEM (90°S to 90°N, 0°E to 360°E). Robinson projection, elevations in meters relative to 2439.4 reference radius, 1° of longitude at the equator is 42.6 km. The lowest point occurs in the bottom of Rachmaninoff crater (R - black arrow) and the highest points (white arrows; H1 4482 m, H2 4458 m) occur on basin massifs (from a pixel scale of 2 km; actual elevation extremes from higher resolution products will likely be more extreme and may be found in different locations). Table 1. Global topographic parameters (2 km/pixel scale).  Mercury Average 73 m Median 51 m Standard Deviation 1092 m Minimum -5380 m Maximum 4481 m Slope (Avg, St. Dev.) 1.8°, 2.1° 