 Lunaserv WMS Software Enhancements N. M. Estes, C. D. Hanger, A. Ramaswamy, A. Johnson, E. BowmanCisneros, M. S. Robinson, School of Earth and Space Exploration, Arizona State University, nme@ser.asu.edu Introduction:  The Lunar Reconnaissance Orbiter Camera  (LROC)  Science  Operations  Center  (SOC) created  the  Lunaserv  Web  Map  Service  (WMS) software  to  solve  key  planetary  data  issues  with previously existing WMS packages [1]. Since the first release  in  2009,  Lunaserv  has  evolved  to  include enhanced  searching,  filtering,  and  visualization capabilities.  Recent  improvements  include  annotated point  layers,  strategic  multi-threading/multiprocessing,  dynamic  map  start  coordinates,  periodic refreshing, and new vector layer filtering capabilities. Layer Updates:  Previous versions of the vector layer allowed for either annotations or points, but these are now combined to allow for annotated points. The same padding rules apply to annotated points, but all points  display even if the points are too crowded to display the annotation (Fig. 1). The point capability of Lunaserv's vector layers was further enhanced to allow rendering icons instead of simple points. This feature also allows specifying the icon's "hot spot" so that the correct point of the icon renders on the point of interest (Figs. 2,3). The "Where is LRO" page on the LROC web site now uses the new annotated points to show LRO's  position  with  time,  altitude,  and latitude/longitude information [2]. Lunaserv Global Explorer (LGE), the OpenLayers based  WMS  client  software,  now  has  a  per-layer configuration for reloading frequently-changing layers. This function will reload the layer, bypassing the web browser's cache, to rapidly display changing data such as illumination or position at regular intervals. LGE  was  also  enhanced  to  allow  specifying  a starting map center location other than 0°,0° on a perbody  basis.  The  starting  location  is  either  a  static Figure 3: Apollo 15 landing site rendered by Lunaserv with a cross-hair indicating the lander position. Figure 2: Apollo 15 landing site rendered by Lunaserv with a pin indicating the lander position. Figure 1: Lunar nomenclature rendered as annotated points showing how all points are rendered but labels are evaluated in priority order and only show if they fit within the padding rules;. The label padding for this image was set to 10 pixels.   latitude and longitude, or LGE can load a coordinate from a JSON web service [3]. The web service could return  the  approximate  latitude  and  longitude  of  the user based on their IP address, or the web service could provide  coordinates  dynamically  based  on  other information. Software  Updates:  There  were  compilation updates for newer compiler versions in the Lunaserv rendering engine.  The primary development platform for Lunaserv is Ubuntu Linux [4] which comes with an updated version of the GCC compiler. There were also two significant improvements to the  rendering  engine  performance  when  processing large  tiled  datasets  such as  the  681 giga-pixel  NAC North Pole Mosaic [5]. The first of these two changes introduces multi-threading while loading the pyramidal TIFF tiles and determining which resolution to use for rendering. By processing many tiles at once, this step completes faster, speeding up map tile rendering. The second performance enhancement breaks up large lists of tiles into multiple sets, ordered by layer priority, and then  renders  those  tile  sets  individually  before compositing the final layer. Keeping  up  with  increasingly  higher-resolution products  requires  further  performance enhancements. One such performance strategy under consideration is to  provide  caching  of  pixel  scale  and  bounding box meta-data to speed up tile selection. Vector Layer Filtering Improvements: The most recent  release of  Lunaserv includes two vector  layer searching  and  filtering  improvements.  The  first expansion  is  to  the  WMS  "GetFeatureInfo"  request type which now allows a bounding box to search for features  in  an  area  instead  of  at  a  point.  This  new search turns the bounding box in map coordinates into a  polygon  in  latitude  and  longitude  coordinates  for searching  against  a  database.  This  new  search capability  falls  back  gracefully  to  a  point  search for WMS clients  or  WMS layers  that  do not  handle the enhanced search. The second enhancement allows for generating  more  complex  SQL clauses  for  database driven layers. The previous filtering capability allows a template  with  a  user-provided  parameter  to  filter database  results  for  rendering  on  a  map.  The  new functionality allows for a file containing Ruby code to process the user-provided parameter to construct more complex  database  expressions.  For  example,  a parameter with JSON encoded values could be passed to Lunaserv where user-provided code could turn the JSON values into a custom database search. Vector Layer Color Coding: When adding vector layers to Lunaserv, it becomes increasingly difficult to choose  a  new  color  with  sufficient  contrast  when combined  with  other  vector  layers  on  any  of  the available  base  maps.  The  challenge  is  greater  still when considering  accessibility  with various types  of color-blindness,  and  that  the  WMS  user  is  free  to combine  layers  in  arbitrary  ways.  After  researching various color schemes, color contrast algorithms, and existing color categorization work, the Lunaserv team chose Kenneth Kelly's  list  of  twenty-two contrasting colors [7] (Fig. 4). The Lunaserv team plans to present additional  details  on  the  color  coding  work  at  the Planetary Data Workshop June 2015 in Flagstaff, AZ. Usage since March 2014: Lunaserv usage in 2014 was approximately four times higher than in 2013 [6]. While  most  usage  comes  from  users  of  LGE,  we continue to see traffic from QGIS and ArcGIS users as well. In May 2014, Lunaserv saw over 1.5 million hits from the osgEarth application from a user in the state of  Washington.  While  the  number  of  independent Lunaserv deployments is unknown, the current version of  the  Lunaserv  installation  package  has  been downloaded 952 times. References: [1] Estes, N.M.; et. al.; (2013), http:// www.lpi.usra.edu/meetings/lpsc/  [2] Where  is  LRO,  http://  lroc.sese.asu.edu/  about/ whereislro  [3]  freegeoip.net,  https://freegeoip.net/ [4] Ubuntu  Linux,  http://www.ubuntu.com/ [5]  681 Gigapixels!,  http://  lroc  .sese  .asu  .edu/  posts/  738 [6] Estes,  N.M.;  et  al.  (2014):,  http://www.hou.usra.edu/ meetings/lpsc/ [7] Kelly, Kenneth L., Color Engineering, 3:26-27, 1965. [8] Scholten, F., et. al.  (2012),  JGR,  117,  E00H17, doi:10.1029/2011JE003926. Figure 4: WAC GLD 100 color Shaded Relief [8] with four RDR vector layers showing the resulting color selection.  http://lroc.sese.asu.edu/posts/738 http://www.ubuntu.com/ https://freegeoip.net/